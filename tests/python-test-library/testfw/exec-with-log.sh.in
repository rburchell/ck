#!/bin/sh

cd "@abs_top_builddir@/tests/python-test-library/testfw"

ulimit -c unlimited
exec >> testing.log 2>&1

if test -n "$TEST_VALGRIND"; then
        export G_DEBUG=${G_DEBUG:+"${G_DEBUG},"}gc-friendly
        export G_SLICE=always-malloc
        WRAPPER="valgrind --leak-check=full --num-callers=20"
        WRAPPER="$WRAPPER --show-reachable=yes"
        WRAPPER="$WRAPPER --gen-suppressions=all"
        WRAPPER="$WRAPPER --child-silent-after-fork=yes"
        WRAPPER="$WRAPPER --suppressions=@abs_top_srcdir@/tests/python-test-library/testfw/glib.supp"
fi

export G_DEBUG=fatal-warnings" ${G_DEBUG}"
#libtool not needed at the moment.
#exec @abs_top_builddir@/libtool --mode=execute $WRAPPER "@abs_top_builddir@/src/context-provider-example"
exec $WRAPPER "@abs_top_builddir@/src/context-provider-example"
